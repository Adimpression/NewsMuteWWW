const $feedsList=$("#feedsList");const $itemTemplate=$(".itemTemplate");const $countryItemTemplate=$(".countryItemTemplate");const $industryItemTemplate=$(".industryItemTemplate");const $countryList=$(".countryList");const $industryList=$(".industryList");const $FeedSetupSubscribe=$(".FeedSetupSubscribe");const $FeedSetupCountries=$(".FeedSetupCountries");const $FeedSetupIndustries=$(".FeedSetupIndustries");const $Loader=$(".Loader");const $Login=$(".Login");const $FeedSetup=$(".FeedSetup");const $FeedInterface=$(".FeedInterface");const $Inception=$(".Inception");const $Busy=$(".Busy");const clsItemTitle=".itemTitle";const clsItemSource=".itemSource";const clsItemDescription=".itemDescription";const clsItemBookmark=".itemBookmark";const clsItemBookmarkText=".itemBookmarkText";const clsItemAdvanced=".itemAdvanced";const clsItemHide=".itemHide";const strId="id";const strClass="class";const flag_super_friend="flag_super_friend";const flag_app_launched="flag_app_launched";const unsubscribe_url="unsubscribe_url";var nordova=true;var currentFeedItems=11;Object.defineProperty(window,"humanId",{get:function(){return window.localStorage.getItem("humanId")},set:function(a){window.localStorage.setItem("humanId",a)}});var feedRefreshTimeout;var isFirstWake=true;function interact_prompt_password_reset(){$choose($("#passwordWrong"))}function post_session(){d("post_session");f(Unsubscribe)();$choose($FeedInterface);$.getScript("js/countries.min.js",function(){d("Loaded Countries")});$.getScript("js/interests.min.js",function(){d("Loaded Interests")});f(intent_yawn_read)();const c=window.localStorage.getItem("lastVisited");if(c!=null){var a=function(g){};var e=function(g){d(g)};f(ajax_scream_link)(c,a,e);f(intent_mark_read)(c);window.localStorage.removeItem("lastVisited")}else{d("lastVisited is null")}var b=window.localStorage.getItem(flag_super_friend);if(b==null){f(intent_super_friend)();notifyLong("Matching friends (Emails not recorded)")}else{}}function hasLoggedIn(){var a=(window.humanId==null||window.humanId=="");return !a}function hasUrlUnsubscribed(){return(window.getUrlParameter("unsubscribe")!="")}function getUrlUnsubscribe(){var a=window.getUrlParameter("unsubscribe");if(a!=""){return decodeURIComponent(a)}else{throw"Not Unsubscribed"}}function hasUnsubscribed(){return window.localStorage.getItem(unsubscribe_url)!=null}function getUnsubscribed(){return window.localStorage.getItem(unsubscribe_url)}function setUnsubscribe(a){window.localStorage.setItem(unsubscribe_url,decodeURIComponent(a))}function resetUnsubscribe(){window.localStorage.removeItem(unsubscribe_url)}function Unsubscribe(){if(!hasLoggedIn()){if(hasUrlUnsubscribed()){setUnsubscribe(getUrlUnsubscribe());notifyShort("Will unsubscribe from "+getUrlUnsubscribe())}}else{if(hasUrlUnsubscribed()){notifyShort("Unsubscribing from "+getUrlUnsubscribe());intent_stalk(getUrlUnsubscribe())}if(hasUnsubscribed()){notifyShort("Unsubscribing from "+getUnsubscribed());intent_stalk(getUnsubscribed());resetUnsubscribe()}}}function confirmLogOff(){if(nordova){if(confirm("Log out?")){intent_remove_login();NewsMute()}}else{navigator.notification.confirm("Are you sure?",a,"Logging out","Yes,No");function a(c){if(c==1){intent_remove_login()}else{}}}}function NewsMute(){f(render_check_humanId)()}var app={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,false);document.addEventListener("resume",function(){try{if(!is_render($FeedSetup)){f(NewsMute)()}}catch(a){if(debug){alert(a)}}},false)},onDeviceReady:function(){app.receivedEvent("deviceready");try{if(!isConnected()){alert("Sorry, for now News Mute needs internet to start. We will fix this soon, promise!");return}d("Initializing...");NewsMute();document.addEventListener("pause",function(){window.localStorage.removeItem(flag_app_launched);window.localStorage.removeItem("lastVisited")},false)}catch(a){if(debug){alert("init error");alert(a)}}},receivedEvent:function(a){}};function intent_prompt_email(){f(track_activity)("Email Box","Click","Empty");intent_sign_check();notifyShort("Your personal details will not be recorded")}function intent_yawn_read(){try{if(isFirstWake){render($Loader)}else{busy()}var c=function(){if(isFirstWake){render($Loader)}else{busy()}};var a=function(){isFirstWake=false;render($FeedInterface)};var b=function(i){j(i);clearInterval(feedRefreshTimeout);feedRefreshTimeout=setTimeout("notifyShort('Checking for any updates (News Mute)'); intent_yawn_read()",10000)};function g(i){try{var k=JSON.parse(i);var l=k.returnValue.data;l.sort(function(o,n){var e=-1;var q=1;var p=0;if(n.shocks<o.shocks){return q}else{if(o.shocks<n.shocks){return e}else{return p}}});currentFeedItems=l.length;l.reverse();f(render_yawn_items)(l)}catch(m){d("Data render error"+m)}}f(ajax_yawn_read)(c,a,b,g,10000)}catch(h){d("intent_yawn_read:"+h)}}function intent_sign_check(){notifyShort("Checking email...");f(ajax_sign_in)($.trim($("#loginEmail").val().toLowerCase()),"Just checking if this user has an account with us",intent_sign_check_response,function(a){d(a);j(a)})}function intent_sign_in(){f(track_activity)("Sign In","Click","Empty");var a=$("#loginPassword").val();if(a==""){notifyLong("Enter a password")}else{if(a==null){notifyLong("Enter a password")}else{if(a.length<6){notifyLong("Enter a password longer that 6 characters")}else{$choose($Loader);notifyShort("Logging in...");already_signed_up_user=false;f(ajax_sign_in)($.trim($("#loginEmail").val().toLowerCase()),get_hash(a),intent_sign_in_response,function(b){d(b);j(b)})}}}}function intent_sign_reset(){f(track_activity)("Renew Password Button","Click","Empty");var a=$("#loginPassword").val();if(a==""){notifyLong("Enter a password")}else{if(a==null){notifyLong("Enter a password")}else{if(a.length<6){notifyLong("Enter a password longer that 6 characters")}else{render($($Loader));notifyShort("Logging in...");f(ajax_sign_up)($.trim($("#loginEmail").val().toLowerCase()),get_hash(a),intent_sign_reset_response,function(b){j(b)})}}}}function intent_sign_up(){f(track_activity)("Sign Up Button","Click","Empty");var a=$("#loginPassword").val();if(a==""){notifyLong("Enter a password")}else{if(a==null){notifyLong("Enter a password")}else{if(a.length<6){notifyLong("Enter a password longer that 6 characters")}else{render($($Loader));notifyShort("Signing up...");f(ajax_sign_up)($.trim($("#loginEmail").val().toLowerCase()),get_hash(a),intent_sign_up_response,function(b){j(b)})}}}}function intent_sign_reset_response(a,i,c){try{window.localStorage.setItem("x-session-header",d(c.getResponseHeader("x-session-header")));var b=j(JSON.parse(a));d(JSON.stringify(b));var g=b.returnValue.data[0];switch(b.returnStatus){case"OK":if(nordova){alert("Click verification link and come back here. Please check spam folder too!")}else{navigator.notification.alert("Click verification link and come back here. Please check spam folder too!",function(){},"Check email","OK")}$choose($Login,$("#signInPrompt"),$("#intentSignInButton"));break;case"ERROR":alert("Renew failed");window.location.href=window.location.href;break;default:alert("News Mute sign UP error:"+b.returnStatus);break}}catch(h){d("intent_sign_reset_response:"+h)}}function intent_sign_in_response(k,l,b,a,g){try{window.localStorage.setItem("x-session-header",d(g.getResponseHeader("x-session-header")));var n=j(JSON.parse(b));var m=n.returnValue.data;var h=m[0];var c=h.status;if(n.returnStatus=="OK"){switch(c){case"OK":window.humanId=get_hash(k);f(post_session)();break;case"ERROR":f(interact_prompt_password_reset)();break;case"NO_ACCOUNT":notifyLong("No account, we are creating one for you...");f(ajax_sign_up)(k,l,intent_sign_up_response,function(e){j(e)});break;default:alert("News Mute sign IN error:"+c);break}}else{d("returnStatus:"+h.returnStatus)}}catch(i){d(i)}}function intent_sign_check_response(k,l,b,a,g){try{window.localStorage.setItem("x-session-header",d(g.getResponseHeader("x-session-header")));var n=j(JSON.parse(b));var m=n.returnValue.data;var h=m[0];var c=h.status;if(n.returnStatus=="OK"){switch(c){case"OK":d("Account available but this should not happen!");break;case"ERROR":if(!$("#intentPasswordResetButton").is(":visible")){$choose($("#intentSignInButton"))}break;case"NO_ACCOUNT":if(!$("#intentPasswordResetButton").is(":visible")){$choose($("#intentSignUpButton"))}break;default:d("Account availability check unknown error");break}}else{d("returnStatus:"+h.returnStatus)}}catch(i){d(i)}}function intent_sign_up_response(b,k,g){try{window.localStorage.setItem("x-session-header",d(g.getResponseHeader("x-session-header")));var c=j(JSON.parse(b));var h=c.returnValue.data[0];var a=h.status;switch(c.returnStatus){case"OK":$choose($("#intentSignInButton"));if(nordova){alert("Click verification link and come back here.")}else{navigator.notification.alert("Click verification link and come back here.",function(){},"Check email","OK")}break;default:d("intent_sign_up_response:returnStatus:"+h.returnStatus);break}}catch(i){d("intent_sign_up_response:"+i)}}function intent_open_link(b){if(currentFeedItems<=11){intent_subscribe_silently_if_valid_feed(b,function(){d("Subscribe failed on auto follow mode")})}if(nordova){var a="width="+window.innerWidth+",height="+window.innerHeight+",scrollbars=no";window.open(b,"popup",a)}else{window.plugins.ChildBrowser.showWebPage(b,{showNavigationBar:true})}}function intent_scream_link(b,a,c){d("Sharing:"+b);if(isValidURL(b)){ajax_scream_link(b,a,c)}else{alert("Sorry :-( This link is not recognized by News Mute")}}function intent_stalk(c){var g=function(h){try{}catch(i){if(debug){alert(i)}}};var b=function(h){if(debug){alert(JSON.stringify(h))}};var a=function(){};var e=function(){};ajax_stalk(c,e,a,g,b)}function intent_unshare(c,b){f(track_activity)("Remove Feed Button","Click",humanId);try{if(nordova){if(confirm("Remove feed permanently?")){a(1)}}else{navigator.notification.confirm("Remove feed permanently?",a,"Remove News Source","Yes,No")}function a(e){if(e==1){var h=function(){};var k=function(){render_hide_item(b)};var l=function(m){notifyShort("Removed feed.")};var i=function(m){j(m)};ajax_unshare(c,k,h,l,i)}else{}}}catch(g){if(debug){alert(g)}}}function intent_mark_read(c){var a=function(){};var e=function(){};var g=function(h){};var b=function(h){j(h)};ajax_mark_read(c,e,a,g,b)}function intent_mark_read_one(c,g){var a=function(){};var e=function(){};var b=function(h){j(h)};ajax_mark_read(c,e,a,g,b)}function intent_subscribe_if_valid_feed(b,a){try{intent_discover_feed_for_url(b.replace(/\s+/g,"")).done(function(g){var e=g.responseData;if(!!e){intent_stalk(e.url);notifyShort("Found website feed. Subscribed!");a()}else{notifyShort("Sorry, News Mute doesn't recognise this website!");return false}})}catch(c){d(c)}}function intent_subscribe_silently_if_valid_feed(b,a){try{intent_discover_feed_for_url(b.replace(/\s+/g,"")).done(function(g){var e=g.responseData;if(!!e){intent_stalk(e.url);a()}else{return false}})}catch(c){d(c)}}function intent_discover_feed_for_url(e){var g="http://ajax.googleapis.com/ajax/services/feed/lookup?v=1.0";var b="&callback=?";var a="&q="+e;var c=g+b+a;return $.getJSON(c)}function intent_super_friend(){d("Finding contacts");function g(r){d("Found contacts: "+r.length);try{var o="";for(var l=0;l<r.length;l++){for(var k=0;r[l].emails!=null&&k<r[l].emails.length;k++){if(r!=""){o=o+"%7C"+get_hash(r[l].emails[k].value)}else{o=get_hash(r[l].emails[k].value)}}if(l%20==0){var p=function(){};var h=function(){};var q=function(e){};var n=function(i){k(JSON.stringify(i))};ajax_super_friend(o,p,h,q,n);o=""}}window.localStorage.setItem(flag_super_friend,"true")}catch(m){if(debug){alert(m)}}}function c(h){d(h)}try{var a=new ContactFindOptions();a.filter="";a.multiple=true;navigator.contacts.find([navigator.contacts.fieldType.emails],g,c,a)}catch(b){if(debug){alert(b)}}}function intent_get_influenced(a){try{ajax_super_friend(a,function(){},function(){},function(){},function(){})}catch(b){if(debug){alert(b)}}}function intent_scream(){var a=prompt("Enter link");if(a==null||a==""){return}intent_scream_link(a,function(b){alert(b)},function(b){alert(b)})}function intent_share(a){f(track_activity)("Give it to friends Button","Click",humanId);try{window.plugins.socialsharing.share(null,null,null,a)}catch(b){if(debug){alert(b)}}}function intent_remove_login(){d("Resetting "+window.humanId);window.localStorage.removeItem("humanId");window.localStorage.removeItem("x-session-header")}function intent_subscribe_search(){f(track_activity)("Subscribe Button","Click",humanId);var a=$("#subscribeSuggestionSeachEntry").val();intent_subscribe_if_valid_feed(a,function(){$("#subscribeSuggestionSeachEntry").val("")})}function make_yawn_item(n){const h=$itemTemplate.clone();const a=crc32(n.link);const k=h.find(clsItemTitle);const c=h.find(clsItemDescription);const m=h.find(clsItemSource);const g=h.find(clsItemBookmark);const i=h.find(clsItemHide);const l=h.find(clsItemBookmarkText);h.attr(strId,a);h.attr(strClass,"itemTemplateShown");h.attr("title",n.link);k.text(n.title.replace(/[|&;$%@"<>()+,]/g,""));k.attr("title",n.link);k.attr("style","font-size: 20px; color: #000000; width:100%;");k.click(function(){render_toggle_content($(this).attr("title"));f(track_activity)("Feed Item Title","Click",humanId)});if(n.source.substring(0,4)=="http"){m.text(n.source)}else{var e=(parseInt(n.shocks)+1);m.html("<span style='color: #960018; font-weight: 900;'>"+e+" "+(e<=1?"friend":"friends")+" liked this</span>")}m.attr("style","font-size: 10px; color: #bbbbbb;");const b=n.description.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/iframe>/gi,"");c.attr("title",n.link);c.html(b);c.find("a").each(function(){var o=$(this).attr("href");$(this).attr("onclick","intent_open_link('"+o+"');").removeAttr("href");$(this).click(function(){$(this).attr("title",n.link);render_hide_up($(this).attr("title"));$("#"+a).removeClass("itemTemplateShown");$("#"+a).addClass("itemTemplateHidden");if($feedsList.find(".itemTemplateShown").length==0){setTimeout("intent_yawn_read();",0)}})});g.attr("title",n.link);g.longpress(f(function(){f(track_activity)("News Button","Long Click",humanId);const o=$("#"+a).attr("title");window.localStorage.setItem("lastVisited",o);ajax_scream_link(o,function(p){},function(p){d(p)});intent_open_link(window.localStorage.getItem("lastVisited"));intent_mark_read_one(o,function(){ajax_yawn_read_one(n.source,function(){},function(){},function(p){j(p)},f(function(p){var r=JSON.parse(p);d(r);var s=r.returnValue.data;if(s!=undefined&&s.length!=0){try{var q=make_yawn_item(s[0]);q.hide();$("#"+a).replaceWith(q);q.fadeTo("slow",1)}catch(t){alert(t)}}else{d("No new entries");$("#"+a).fadeOut("fast",function(){render_hide_item(a);$("#"+a).removeClass("itemTemplateShown");$("#"+a).addClass("itemTemplateHidden");if($feedsList.find(".itemTemplateShown").length==0){setTimeout("intent_yawn_read();",700)}})}}),10000)})}),f(function(){f(track_activity)("News Button","Short Click",humanId);const o=$("#"+a).attr("title");window.localStorage.setItem("lastVisited",o);ajax_scream_link(o,function(p){},function(p){if(debug){alert(p)}});l.text("Shared!");$("#"+a).fadeOut("slow",function(){render_hide_up(o);$("#"+a).removeClass("itemTemplateShown");$("#"+a).addClass("itemTemplateHidden");if($feedsList.find(".itemTemplateShown").length==0){setTimeout("intent_yawn_read();",700)}intent_open_link(window.localStorage.getItem("lastVisited"))})}),150);h.find(clsItemAdvanced).attr("title",n.source);h.find(clsItemAdvanced).attr("data-nmid",n.link);i.attr("title",n.link);i.longpress(f(function(){f(track_activity)("Mute Button","Long Click",humanId);intent_mark_read_one(n.link,function(){$("#"+a).fadeTo("fast",0,function(){ajax_yawn_read_one(n.source,function(){},function(){},function(o){j(o)},f(function(o){var q=JSON.parse(o);d(q);var r=q.returnValue.data;if(r!=undefined&&r.length!=0){try{var p=make_yawn_item(r[0]);p.hide();$("#"+a).replaceWith(p);p.fadeTo("slow",1)}catch(s){alert(s)}}else{d("No new entries");$("#"+a).fadeOut("fast",function(){render_hide_item(a);$("#"+a).removeClass("itemTemplateShown");$("#"+a).addClass("itemTemplateHidden");if($feedsList.find(".itemTemplateShown").length==0){setTimeout("intent_yawn_read();",2000)}})}}),10000)})})}),f(function(){f(track_activity)("Mute Button","Short Click",humanId);$(this).fadeOut("fast",function(){render_hide_item($(this).attr("title"));$("#"+a).removeClass("itemTemplateShown");$("#"+a).addClass("itemTemplateHidden");if($feedsList.find(".itemTemplateShown").length==0){setTimeout("intent_yawn_read();",2000)}})}),150);return h}function make_country_item(a){var b;b=$countryItemTemplate.clone();b.find(".title").text(a.title);b.click(function(){a.feeds.forEach(function(c){if(c!=null&&c!=""){intent_stalk(c)}});intent_get_influenced(a.title.replace(/ /g,"").toLowerCase()+"@adimpression.mobi");$choose($FeedSetupIndustries)});return b}function make_industry_item(a){const b=$industryItemTemplate.clone();b.find(".title").text(a.title);b.click(function(){a.feeds.forEach(function(c){intent_stalk(c)});$choose($FeedSetupSubscribe)});return b}function render_initial_setup(){try{clearTimeout(feedRefreshTimeout);$choose($FeedSetup);$choose($FeedSetupCountries);var b=document.createDocumentFragment();for(var c=0;c<countries.length;c++){(function(k,e){const l=countries[k];const m=make_country_item(l);if(m!=null){m.appendTo(b);if(k+1==e){}}})(c,countries.length)}$countryList.empty();$countryList.append(b);var a=document.createDocumentFragment();for(var g=0;g<industries.length;g++){(function(i,e){const k=industries[i];const l=make_industry_item(k);l.appendTo(a);if(i+1==e){}})(g,industries.length)}$industryList.empty();$industryList.append(a)}catch(h){alert(h)}}function render_check_humanId(){if(!hasLoggedIn()){render_sign_in();f(Unsubscribe)()}else{f(post_session)()}}function render_yawn_items(e){const c=e.length;const g=new Date().getTime();const b=document.createDocumentFragment();$feedsList.empty();for(var a=0;a<c&&a<100;a++){(function(h){const k=e[h];var l=make_yawn_item(k);l.appendTo(b);if(h<5){l.animate({opacity:0});l.animate({opacity:1},{duration:h*300,complete:function(){for(h=0;h<1;h++){l.fadeTo("slow",0.5).fadeTo("slow",1);setTimeout("clone.fadeTo(0, 2.0);",2000)}}})}})(a)}if(c>0){clearTimeout(feedRefreshTimeout)}else{clearTimeout(feedRefreshTimeout);feedRefreshTimeout=setTimeout("notifyShort('Checking for any updates (News Mute)'); intent_yawn_read()",10000);notifyShort("No new news. Will recheck. (News Mute)")}$feedsList.append(b);render($FeedInterface);if(isFirstWake){}else{free()}$feedsList.slideDown();d("Completed in "+(new Date().getTime()-g))}function render_toggle_content(a){try{var g=crc32(a);var b=$("#"+g).find(".itemDescription");if(b.is(":visible")){b.slideUp()}else{b.slideDown()}}catch(c){if(debug){alert(c)}}}function render_hide_item(b){try{intent_mark_read(b);var i=crc32(b);var g="undo"+i;var a=$("#"+i);var h=$(".itemUndoTemplate").clone().removeClass("itemUndoTemplate");h.find(".itemTitle").text(a.find(".itemTitle").text());h.attr("title",b);h.attr(strId,g);h.find((".itemBookmark")).click(function(){const e=$("#"+g).attr("title");window.localStorage.setItem("lastVisited",e);$("#"+g).hide();ajax_scream_link(e,function(k){},function(k){if(debug){alert(k)}});intent_open_link(e)});a.fadeOut(0).after(h);h.fadeIn(300).delay(5000).slideUp(100)}catch(c){if(debug){alert(c)}}}function render_hide_up(a){try{intent_mark_read(a);var c=crc32(a);$("#"+c).animate({opacity:0.1},{duration:100,complete:function(){$("#"+c).slideUp(300)}})}catch(b){if(debug){alert(b)}}}function render_sign_in(){var a=window.getUrlParameter("email");if(a!=""){$("#loginEmail").val(a)}$choose($("#signInPrompt"))}function render_reset(){$choose($("#signInPrompt"));$choose($("#intentPasswordResetButton"))}function render_inception(){$choose($Inception);$.ajax({url:"http://9ce2a77da623b7f5181c-97dce30d10f9c13337ec01a7a52138ac.r0.cf2.rackcdn.com/countries.js",dataType:"script"});$.ajax({url:"http://9ce2a77da623b7f5181c-97dce30d10f9c13337ec01a7a52138ac.r0.cf2.rackcdn.com/interests.js",dataType:"script"})}function render(a){if(a!=$Loader){$Loader.hide()}if(a!=$FeedSetup){$FeedSetup.hide()}if(a!=$FeedInterface){$FeedInterface.hide()}if(a!=$Inception){$Inception.hide()}if(a!=$Busy){$Busy.hide()}if(a!=$Login){$Login.hide()}a.show()}function is_render(a){return a.is(":visible")}function track_activity(c,b,a){f(_paq.push)(["trackEvent",c,b,a])};